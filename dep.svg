<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1402px" preserveAspectRatio="none" style="width:1167px;height:1402px;" version="1.1" viewBox="0 0 1167 1402" width="1167px" zoomAndPan="magnify"><defs/><g><!--MD5=[97f29ad3238a01ebe834eec82bab4623]
cluster k8s_env--><rect fill="#FFFFFF" height="1165" style="stroke:#444444;stroke-width:1.0;stroke-dasharray:7.0,7.0;" width="1154" x="7" y="231"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="84" x="542" y="245.9951">«boundary»</text><text fill="#444444" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="221" x="473.5" y="264.1484">Kubernetes environment</text><text fill="#444444" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="62" x="553" y="279.0605">[System]</text><!--MD5=[b3b9e5acee42b672c97a29442bc9c271]
cluster catalog_service_postgis_boundary--><rect fill="#FFFFFF" height="198" style="stroke:#444444;stroke-width:1.0;stroke-dasharray:7.0,7.0;" width="483" x="184" y="969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="84" x="383.5" y="983.9951">«boundary»</text><text fill="#444444" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="175" x="338" y="1002.1484">postgis deployment</text><text fill="#444444" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="80" x="385.5" y="1017.0605">[Container]</text><!--MD5=[bd37c346397033a5acc2d866e73df49f]
cluster pycsw_boundary--><rect fill="#FFFFFF" height="182" style="stroke:#444444;stroke-width:1.0;stroke-dasharray:7.0,7.0;" width="250" x="173" y="491"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="84" x="256" y="505.9951">«boundary»</text><text fill="#444444" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="166" x="215" y="524.1484">pycsw deployment</text><text fill="#444444" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="80" x="258" y="539.0605">[Container]</text><!--MD5=[f02884c92ce3ce31db88229c5c1b9198]
cluster boundary_dmci--><rect fill="#FFFFFF" height="182" style="stroke:#444444;stroke-width:1.0;stroke-dasharray:7.0,7.0;" width="167" x="451" y="491"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="84" x="492.5" y="505.9951">«boundary»</text><text fill="#444444" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="151" x="459" y="524.1484">dmci deployment</text><text fill="#444444" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="80" x="494.5" y="539.0605">[Container]</text><!--MD5=[fb89feb516a78bec0ddbc6ef44d569aa]
cluster boundary_mms--><rect fill="#FFFFFF" height="182" style="stroke:#444444;stroke-width:1.0;stroke-dasharray:7.0,7.0;" width="226" x="911" y="491"/><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="84" x="982" y="505.9951">«boundary»</text><text fill="#444444" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="152" x="948" y="524.1484">mms deployment</text><text fill="#444444" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="80" x="984" y="539.0605">[Container]</text><!--MD5=[f02acbec7f163ad128c4d6770a2bfa44]
entity catalog_service_postgis_conf--><rect fill="#85BBF0" height="115.4531" style="stroke:#78A8D8;stroke-width:1.5;" width="180" x="31" y="1260.5"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="85" x="78.5" y="1281.6387">«component»</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="65" x="88.5" y="1299.3203">postgis</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="75" x="83.5" y="1314.2324">[configmap]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="123" y="1330.0576"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152" x="45" y="1346.3545">passwd file for making</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="141" x="50.5" y="1362.6514">PostGIS work in K8s.</text><!--MD5=[71460f55096b75621c94f5326fbdc513]
entity pycsw_config--><rect fill="#85BBF0" height="115.4531" style="stroke:#78A8D8;stroke-width:1.5;" width="143" x="23.5" y="784.5"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="85" x="52.5" y="805.6387">«component»</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="117" x="36.5" y="823.3203">pycsw-config</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="75" x="57.5" y="838.2324">[configmap]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="97" y="854.0576"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="115" x="37.5" y="870.3545">Common PyCSW</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117" x="36.5" y="886.6514">configuration file.</text><!--MD5=[fb4a491c5dc9dc3c575e5c53f0689d6b]
entity config_dmci--><rect fill="#85BBF0" height="99.1563" style="stroke:#78A8D8;stroke-width:1.5;" width="205" x="435.5" y="792.5"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="85" x="495.5" y="813.6387">«component»</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="102" x="487" y="831.3203">dmci-config</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="75" x="500.5" y="846.2324">[configmap]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="540" y="862.0576"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="181" x="449.5" y="878.3545">Configuraiton file for DMCI.</text><!--MD5=[8a2bf1ac6938388d859417881613e516]
entity catalog_service_postgis_service--><rect fill="#85BBF0" height="131.75" style="stroke:#78A8D8;stroke-width:1.5;" width="199" x="201.5" y="776"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="85" x="258.5" y="797.1387">«component»</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="65" x="268.5" y="814.8203">postgis</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="53" x="274.5" y="829.7324">[service]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="303" y="845.5576"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134" x="234" y="861.8545">Service component</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="175" x="211.5" y="878.1514">exposing PostGIS on port</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="281" y="894.4482">5432.</text><!--MD5=[ee0ae862b88f112cf75450280b23f93e]
entity pycsw_service--><rect fill="#85BBF0" height="131.75" style="stroke:#78A8D8;stroke-width:1.5;" width="218" x="189" y="298"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="85" x="255.5" y="319.1387">«component»</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="56" x="270" y="336.8203">pycsw</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="53" x="271.5" y="351.7324">[service]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="300" y="367.5576"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134" x="231" y="383.8545">Service component</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="194" x="199" y="400.1514">exposing PyCSW API on port</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="22" x="287" y="416.4482">80.</text><!--MD5=[76047bb411f7657332b6d6955952d6b0]
entity service_dmci--><rect fill="#85BBF0" height="131.75" style="stroke:#78A8D8;stroke-width:1.5;" width="206" x="442" y="298"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="85" x="502.5" y="319.1387">«component»</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="41" x="524.5" y="336.8203">dmci</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="53" x="518.5" y="351.7324">[service]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="547" y="367.5576"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134" x="478" y="383.8545">Service component</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="182" x="452" y="400.1514">exposing DMCI API on port</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="525" y="416.4482">8000.</text><!--MD5=[fe9d8315e446909022ce2909f4a94c02]
entity service_mms_nats--><rect fill="#85BBF0" height="115.4531" style="stroke:#78A8D8;stroke-width:1.5;" width="213" x="683.5" y="306.5"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="85" x="747.5" y="327.6387">«component»</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="88" x="746" y="345.3203">mms-nats</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="53" x="763.5" y="360.2324">[service]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="792" y="376.0576"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="185" x="697.5" y="392.3545">MMS Nats service exposed</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="153" x="713.5" y="408.6514">on NodePort on 4222.</text><!--MD5=[bd47cd56cfb2ecc8895dec285c51ff0c]
entity service_mms_http--><rect fill="#85BBF0" height="115.4531" style="stroke:#78A8D8;stroke-width:1.5;" width="203" x="931.5" y="306.5"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="85" x="990.5" y="327.6387">«component»</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="87" x="989.5" y="345.3203">mms-http</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="53" x="1006.5" y="360.2324">[service]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="1035" y="376.0576"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="175" x="945.5" y="392.3545">MMS API service exposed</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94" x="986" y="408.6514">on port 8080.</text><!--MD5=[900d1ed132baa57def00fe05c265c030]
entity catalog_service_postgis_storage--><path d="M246.5,1266 C246.5,1256 338,1256 338,1256 C338,1256 429.5,1256 429.5,1266 L429.5,1370.4531 C429.5,1380.4531 338,1380.4531 338,1380.4531 C338,1380.4531 246.5,1380.4531 246.5,1370.4531 L246.5,1266 " fill="#85BBF0" style="stroke:#78A8D8;stroke-width:1.5;"/><path d="M246.5,1266 C246.5,1276 338,1276 338,1276 C338,1276 429.5,1276 429.5,1266 " fill="none" style="stroke:#78A8D8;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="85" x="295.5" y="1291.1387">«component»</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="65" x="305.5" y="1308.8203">postgis</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="31" x="322.5" y="1323.7324">[pvc]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="340" y="1339.5576"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="155" x="260.5" y="1355.8545">Permanent storage for</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="58" x="309" y="1372.1514">PostGIS.</text><!--MD5=[944abc3a2c5a33f0d81e8c0a299cd75c]
entity storage_dmci--><path d="M676,790 C676,780 783,780 783,780 C783,780 890,780 890,790 L890,894.4531 C890,904.4531 783,904.4531 783,904.4531 C783,904.4531 676,904.4531 676,894.4531 L676,790 " fill="#85BBF0" style="stroke:#78A8D8;stroke-width:1.5;"/><path d="M676,790 C676,800 783,800 783,800 C783,800 890,800 890,790 " fill="none" style="stroke:#78A8D8;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="85" x="740.5" y="815.1387">«component»</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="117" x="724.5" y="832.8203">dmci-storage</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="31" x="767.5" y="847.7324">[pvc]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="785" y="863.5576"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="186" x="690" y="879.8545">Permanent archive storage</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="62" x="752" y="896.1514">for DMCI.</text><!--MD5=[1c9491d2a2d749741cfd6991fe91d0b1]
entity storage_mms--><path d="M925,798 C925,788 1035,788 1035,788 C1035,788 1145,788 1145,798 L1145,886.1563 C1145,896.1563 1035,896.1563 1035,896.1563 C1035,896.1563 925,896.1563 925,886.1563 L925,798 " fill="#85BBF0" style="stroke:#78A8D8;stroke-width:1.5;"/><path d="M925,798 C925,808 1035,808 1035,808 C1035,808 1145,808 1145,798 " fill="none" style="stroke:#78A8D8;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="85" x="992.5" y="823.1387">«component»</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="117" x="976.5" y="840.8203">mms-workdir</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="31" x="1019.5" y="855.7324">[pvc]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="1037" y="871.5576"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="196" x="939" y="887.8545">Permanent storage for MMS.</text><!--MD5=[f8a2cde5192702d0b05947e5b4eee24c]
entity init_db_directory--><rect fill="#85BBF0" height="99.1563" style="stroke:#78A8D8;stroke-width:1.5;" width="214" x="437" y="1044"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="85" x="501.5" y="1065.1387">«component»</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="144" x="472" y="1082.8203">init-db-directory</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="48" x="520" y="1097.7324">[alpine]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="546" y="1113.5576"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="190" x="451" y="1129.8545">Initialize database directory.</text><!--MD5=[2b7d838cbd7b9d508261623db6afab1a]
entity catalog_service_postgis--><rect fill="#85BBF0" height="115.4531" style="stroke:#78A8D8;stroke-width:1.5;" width="201" x="200.5" y="1036"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="85" x="258.5" y="1057.1387">«component»</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="65" x="268.5" y="1074.8203">postgis</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="102" x="250" y="1089.7324">[postgis/postgis]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="303" y="1105.5576"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="173" x="214.5" y="1121.8545">Holds ISO data translated</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="148" x="227" y="1138.1514">from MMD for PyCSW.</text><!--MD5=[266f495ddff2b88ba7bd99807d9b2a51]
entity pycsw1--><rect fill="#85BBF0" height="99.1563" style="stroke:#78A8D8;stroke-width:1.5;" width="218" x="189" y="558"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="85" x="255.5" y="579.1387">«component»</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="56" x="270" y="596.8203">pycsw</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="120" x="238" y="611.7324">[geopython/pycsw]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="300" y="627.5576"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="194" x="203" y="643.8545">Running instance of PyCSW.</text><!--MD5=[bed958ca9868eaba710bd7f4a243bfc8]
entity container_dmci--><rect fill="#85BBF0" height="99.1563" style="stroke:#78A8D8;stroke-width:1.5;" width="123" x="477.5" y="558"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="85" x="496.5" y="579.1387">«component»</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="47" x="515.5" y="596.8203">DMCI</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="103" x="487.5" y="611.7324">[container-dmci]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="541" y="627.5576"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="96" x="493" y="643.8545">The DMCI API.</text><!--MD5=[87904ee5e27c5dbc18d5af6c0f064388]
entity container_go_mms--><rect fill="#85BBF0" height="99.1563" style="stroke:#78A8D8;stroke-width:1.5;" width="194" x="927" y="558"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="85" x="981.5" y="579.1387">«component»</text><text fill="#000000" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="42" x="1003" y="596.8203">mms</text><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="117" x="965.5" y="611.7324">[conainer-go-mms]</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="1026" y="627.5576"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="170" x="941" y="643.8545">MMS Messaging Service.</text><!--MD5=[a6e6e56ccc42f330355e4c933d7c5cc2]
entity internal_user--><rect fill="#08427B" height="149.4844" style="stroke:#073B6F;stroke-width:1.5;" width="218" x="541" y="7"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="57" x="621.5" y="28.1387">«person»</text><image height="48" width="48" x="626" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAIAAADYYG7QAAABuUlEQVR42u2Yv0oEMRDGp/QRfIR7BVs7Gx9AH0CwtrtKLNXSRsRSG8HCxkbQVrSykoOrzlILC9v4gwMRNptMMsnu3nHDFMcSLh/f/PsmsrY5HpTLUgHaOri8uHt+eJm8vs/wm8e38fn9aPekB0D7p7df3z+uxYC4sXfWEaD17SPIcAqDreqAQBMgpmnHV091ASm5+W8EtxYgQuCyDF7LA+JPXa5RieUBwbwzWHlAVLIFEB2rMKCk4rK0AC0gZzN9/S8soOnHpwWQvhtpATE4h5XUlrKnIKp06uxCS5poCzs6stvjzuF1XfmRVG4ZkihHMSp5SuXGJGG5LEAVPSIpb4qJfIQzQeF6OMORGXSHbCjLuAb1CYhti7whQHQ5PLrlcHh+kiAyN/RxFE0/9OYvH+dJw33gw/nB4bYa5Ltmokl4MTXqMi+sMFtSfFBEDWoD67bUkPSa+d/Gk3i7i6tvxE4LyLhgGOeu9ELPXzLFAVHJrkNrZreUFfN28S9l1x27upVSLwp5hlIYFqBm8a8ADRxQJIfszy72ZxrpeKxGR6xnltEbupkbXtkpbQsh6ozhV8kDCni1dcT8F2bsoAKLcdt7AAAAAElFTkSuQmCC" y="30.9688"/><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="41" x="629.5" y="93.8203">User</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="0" x="652" y="110.5889"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="190" x="555" y="126.8857">User of the S-ENDA Vagrant</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="628" y="143.1826">setup.</text><!--MD5=[3113bf2e5b7b958a8f712611c6bb61a1]
link catalog_service_postgis to catalog_service_postgis_conf--><path d="M208.8,1151.21 C197.17,1160.87 186.15,1171.53 177,1183 C160.68,1203.45 148.39,1229.34 139.55,1252.9 " fill="none" id="catalog_service_postgis-to-catalog_service_postgis_conf" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="136.79,1260.46,142.3512,1253.9737,136.715,1251.9163,136.79,1260.46" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="130" x="178" y="1209.1387">Mount passwd file</text><!--MD5=[a8196e785357edc8159f32345363b33b]
link catalog_service_postgis to catalog_service_postgis_storage--><path d="M310.43,1151.22 C315.31,1180.53 321.3,1216.55 326.45,1247.52 " fill="none" id="catalog_service_postgis-to-catalog_service_postgis_storage" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="327.81,1255.69,329.4564,1247.3061,323.5378,1248.2908,327.81,1255.69" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="101" x="329.5" y="1195.1387">Stores data in</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="112" x="324" y="1209.1074">physical volume</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="36" x="364" y="1223.0762">claim</text><!--MD5=[c4d9b00302829ed014d12dcdf470bdaa]
link pycsw1 to pycsw_config--><path d="M188.67,651.75 C172.05,662.02 156.35,674.35 144,689 C123.33,713.51 111.34,746.89 104.4,776.12 " fill="none" id="pycsw1-to-pycsw_config" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="102.57,784.25,107.2548,777.1049,101.4015,775.7863,102.57,784.25" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="146" x="145" y="722.1387">Mount the config file</text><!--MD5=[11066804b7ccd181933291302a565ec5]
link pycsw_service to pycsw1--><path d="M298,430.04 C298,467.28 298,513.59 298,549.42 " fill="none" id="pycsw_service-to-pycsw1" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="298,557.83,301,549.83,295,549.83,298,557.83" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="17" x="299" y="472.1387">LB</text><!--MD5=[9296b8b3af7c368d710e517fe08f368c]
link pycsw1 to catalog_service_postgis_service--><path d="M298.63,657.24 C299.04,689.3 299.59,731.85 300.06,767.93 " fill="none" id="pycsw1-to-catalog_service_postgis_service" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="300.16,776,303.0598,767.9631,297.0602,768.0381,300.16,776" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="117" x="301" y="715.1387">Reads data from</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="60" x="331.5" y="729.1074">PostGIS.</text><!--MD5=[1c7ddb274974e857628922aaaeb5541a]
link catalog_service_postgis_service to catalog_service_postgis--><path d="M301,908.23 C301,945.01 301,990.8 301,1027.54 " fill="none" id="catalog_service_postgis_service-to-catalog_service_postgis" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="301,1035.71,304,1027.71,298,1027.71,301,1035.71" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="17" x="302" y="950.1387">LB</text><!--MD5=[b067dd77d4fea2bd21984afcded5519c]
link service_dmci to container_dmci--><path d="M543.38,430.04 C542.46,467.28 541.31,513.59 540.42,549.42 " fill="none" id="service_dmci-to-container_dmci" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="540.21,557.83,543.409,549.9075,537.4109,549.7575,540.21,557.83" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="17" x="544" y="472.1387">LB</text><!--MD5=[c8c92ea20e10246977c24de14c1371c4]
link container_dmci to storage_dmci--><path d="M600.77,641.24 C622.89,654.49 647.23,670.94 667,689 C694,713.66 719.25,745.25 739.25,773.23 " fill="none" id="container_dmci-to-storage_dmci" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="743.95,779.89,741.7825,771.6255,736.8827,775.0886,743.95,779.89" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="123" x="717" y="701.1387">Store XML files in</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="87" x="735" y="715.1074">archive, and</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="123" x="717" y="729.0762">persistent queue</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="56" x="752.5" y="743.0449">storage</text><!--MD5=[7a98cbb4b7170dce6857136c8e53c78f]
reverse link pycsw_service to container_dmci--><path d="M374.4,435.74 C390.62,451.14 407.51,467.48 423,483 C447.1,507.16 473.17,534.78 494.49,557.77 " fill="none" id="pycsw_service-backto-container_dmci" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="368.46,430.11,372.2002,437.7919,376.329,433.4384,368.46,430.11" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="113" x="415" y="472.1387">Insert new data</text><!--MD5=[f6337f2e371bf43a376eec1c17fa657a]
link container_dmci to config_dmci--><path d="M538.79,657.24 C538.63,694.29 538.41,745.33 538.24,784.22 " fill="none" id="container_dmci-to-config_dmci" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="538.21,792.32,541.2528,784.3362,535.2529,784.304,538.21,792.32" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="118" x="540" y="722.1387">Mount config file</text><!--MD5=[a0448d000d212d7e8e0c2d0180ff018f]
link service_mms_nats to container_go_mms--><path d="M844.86,421.62 C882.95,460.92 933.4,513 971.06,551.86 " fill="none" id="service_mms_nats-to-container_go_mms" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="976.99,557.98,973.5828,550.1448,969.271,554.3171,976.99,557.98" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="17" x="893" y="472.1387">LB</text><!--MD5=[46913ac3b9c5a719ba61af26c452f2b6]
link service_mms_http to container_go_mms--><path d="M1030.89,421.62 C1029.45,460.28 1027.55,511.29 1026.11,549.93 " fill="none" id="service_mms_http-to-container_go_mms" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="1025.81,557.98,1029.1082,550.0983,1023.1124,549.873,1025.81,557.98" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="17" x="1030" y="472.1387">LB</text><!--MD5=[3d4e6f3d65e3d4febe0dca5c40706833]
link container_go_mms to storage_mms--><path d="M1026.31,657.24 C1027.99,692.92 1030.3,741.58 1032.11,779.86 " fill="none" id="container_go_mms-to-storage_mms" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="1032.49,787.87,1035.1006,779.7346,1029.1075,780.024,1032.49,787.87" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="119" x="1031" y="722.1387">Stores database</text><!--MD5=[b3686706b3a6d076c773dcfc094b71ab]
link internal_user to pycsw_service--><path d="M540.94,123.96 C505.75,140.26 467.88,161.09 437,186 C400.65,215.32 367.94,255.85 343.39,290.73 " fill="none" id="internal_user-to-pycsw_service" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="338.6,297.62,345.6362,292.7731,340.7143,289.3417,338.6,297.62" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="134" x="438" y="198.1387">Access CSW API via</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="106" x="452" y="212.1074">[10.10.10.10:80]</text><!--MD5=[bda149761e94e64917fb5f0dc793c9f9]
link internal_user to service_dmci--><path d="M604.88,156.23 C599.8,166.05 595.01,176.13 591,186 C577.55,219.08 567.04,257.26 559.48,289.67 " fill="none" id="internal_user-to-service_dmci" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="557.62,297.78,562.3297,290.6512,556.481,289.3123,557.62,297.78" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="137" x="592" y="198.1387">Access DMCI API via</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="122" x="599.5" y="212.1074">[10.10.10.10:8000]</text><!--MD5=[519573384a8c1a7523f199c7e6dccfb5]
link internal_user to service_mms_nats--><path d="M715.19,156.2 C722.1,165.86 728.57,175.91 734,186 C752.89,221.07 766.59,263.53 775.71,298.08 " fill="none" id="internal_user-to-service_mms_nats" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="777.82,306.22,778.7239,297.7239,772.9146,299.2245,777.82,306.22" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="146" x="748" y="198.1387">Access MMS Nats via</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="122" x="760" y="212.1074">[10.10.10.10:4222]</text><!--MD5=[e28459387fef5ec1086628c7800ed184]
link internal_user to service_mms_http--><path d="M759.06,112.42 C806.48,128.97 860.73,153 903,186 C942.33,216.7 975.42,262.26 998.37,299.47 " fill="none" id="internal_user-to-service_mms_http" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="1002.54,306.32,1000.9503,297.9252,995.8224,301.0405,1002.54,306.32" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="135" x="934" y="198.1387">Access MMS API via</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="122" x="940.5" y="212.1074">[10.10.10.10:8080]</text><!--MD5=[c074e677799727c2d16331997db91f42]
@startuml dep
!includeurl https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/v2.0.1/C4_Component.puml

LAYOUT_TOP_DOWN()
'LAYOUT_LEFT_RIGHT
'LAYOUT_WITH_LEGEND()
'LAYOUT_AS_SKETCH()


'
' Persons
'
Person(internal_user, "User", "User of the S-ENDA Vagrant setup.")

'- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

System_Boundary(k8s_env, "Kubernetes environment") {

  '
  ' ConfigMap
  '
  Component(catalog_service_postgis_conf, "postgis", "configmap", "passwd file for making PostGIS work in K8s.")
  Component(pycsw_config, "pycsw-config", "configmap", "Common PyCSW configuration file.")
  Component(config_dmci, "dmci-config", "configmap", "Configuraiton file for DMCI.")

  '
  ' Services
  '
  Component(catalog_service_postgis_service, "postgis", "service", "Service component exposing PostGIS on port 5432.")
  Component(pycsw_service, "pycsw", "service", "Service component exposing PyCSW API on port 80.")
  Component("service_dmci", "dmci", "service", "Service component exposing DMCI API on port 8000.")
  Component("service_mms_nats", "mms-nats", "service", "MMS Nats service exposed on NodePort on 4222.")
  Component("service_mms_http", "mms-http", "service", "MMS API service exposed on port 8080.")


  '
  ' Deployment postgis
  '
  Container_Boundary("catalog_service_postgis_boundary", "postgis deployment") {
    Component(init_db_directory, "init-db-directory", "alpine", "Initialize database directory.")
    Component(catalog_service_postgis, "postgis", "postgis/postgis", "Holds ISO data translated from MMD for PyCSW.")
    Rel(catalog_service_postgis, catalog_service_postgis_conf, "Mount passwd file")
  }

  ComponentDb(catalog_service_postgis_storage, "postgis", "pvc", "Permanent storage for PostGIS.")
  ComponentDb(storage_dmci, "dmci-storage", "pvc", "Permanent archive storage for DMCI.")
  ComponentDb(storage_mms, "mms-workdir", "pvc", "Permanent storage for MMS.")

  Rel(catalog_service_postgis, catalog_service_postgis_storage, "Stores data in physical volume claim")

  '
  ' Deployment pycsw
  '
  Container_Boundary("pycsw_boundary", "pycsw deployment") {
    Component(pycsw1, "pycsw", "geopython/pycsw", "Running instance of PyCSW.")

    Rel(pycsw1, pycsw_config, "Mount the config file")
    Rel(pycsw_service, pycsw1, "LB")
  }

  Rel(pycsw1, catalog_service_postgis_service, "Reads data from PostGIS.")
  Rel(catalog_service_postgis_service, catalog_service_postgis, "LB")

  '
  ' Deployment dmci
  '
  Container_Boundary("boundary_dmci", "dmci deployment") {
    Component("container_dmci", "DMCI", "container-dmci", "The DMCI API.")

    Rel(service_dmci, "container_dmci", "LB")
    Rel(container_dmci, storage_dmci, "Store XML files in archive, and persistent queue storage")
    Rel_U(container_dmci, pycsw_service, "Insert new data")
    Rel(container_dmci, config_dmci, "Mount config file")
  }

  '
  ' Deployment dmci
  '
  Container_Boundary("boundary_mms", "mms deployment") {
    Component(container_go_mms, "mms", "conainer-go-mms", "MMS Messaging Service.")

    Rel(service_mms_nats, container_go_mms, "LB")
    Rel(service_mms_http, container_go_mms, "LB")
    Rel(container_go_mms, storage_mms, "Stores database")
  }


  '
  ' Deployment pycsw-ingest
  '

  Rel(internal_user, pycsw_service, "Access CSW API via", "10.10.10.10:80")
  Rel(internal_user, service_dmci, "Access DMCI API via", "10.10.10.10:8000")
  Rel(internal_user, service_mms_nats, "Access MMS Nats via", "10.10.10.10:4222")
  Rel(internal_user, service_mms_http, "Access MMS API via", "10.10.10.10:8080")

}

@enduml

@startuml dep





skinparam defaultTextAlignment center

skinparam wrapWidth 200
skinparam maxMessageSize 150

skinparam LegendBorderColor transparent
skinparam LegendBackgroundColor transparent
skinparam LegendFontColor #FFFFFF

skinparam rectangle {
    StereotypeFontSize 12
    shadowing false
}

skinparam database {
    StereotypeFontSize 12
    shadowing false
}

skinparam queue {
    StereotypeFontSize 12
    shadowing false
}

skinparam Arrow {
    Color #666666
    FontColor #666666
    FontSize 12
}

skinparam rectangle<<boundary>> {
    Shadowing false
    StereotypeFontSize 0
    FontColor #444444
    BorderColor #444444
    BorderStyle dashed
}





























skinparam rectangle<<person>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #08427B
    BorderColor #073B6F
}

skinparam rectangle<<external_person>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #686868
    BorderColor #8A8A8A
}

skinparam rectangle<<system>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #1168BD
    BorderColor #3C7FC0
}

skinparam rectangle<<external_system>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #999999
    BorderColor #8A8A8A
}

sprite $person [48x48/16] {
000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000
0000000000000000000049BCCA7200000000000000000000
0000000000000000006EFFFFFFFFB3000000000000000000
00000000000000001CFFFFFFFFFFFF700000000000000000
0000000000000001EFFFFFFFFFFFFFF80000000000000000
000000000000000CFFFFFFFFFFFFFFFF6000000000000000
000000000000007FFFFFFFFFFFFFFFFFF100000000000000
00000000000001FFFFFFFFFFFFFFFFFFF900000000000000
00000000000006FFFFFFFFFFFFFFFFFFFF00000000000000
0000000000000BFFFFFFFFFFFFFFFFFFFF40000000000000
0000000000000EFFFFFFFFFFFFFFFFFFFF70000000000000
0000000000000FFFFFFFFFFFFFFFFFFFFF80000000000000
0000000000000FFFFFFFFFFFFFFFFFFFFF80000000000000
0000000000000DFFFFFFFFFFFFFFFFFFFF60000000000000
0000000000000AFFFFFFFFFFFFFFFFFFFF40000000000000
00000000000006FFFFFFFFFFFFFFFFFFFE00000000000000
00000000000000EFFFFFFFFFFFFFFFFFF800000000000000
000000000000007FFFFFFFFFFFFFFFFFF100000000000000
000000000000000BFFFFFFFFFFFFFFFF5000000000000000
0000000000000001DFFFFFFFFFFFFFF70000000000000000
00000000000000000BFFFFFFFFFFFF500000000000000000
0000000000000000005DFFFFFFFFA1000000000000000000
0000000000000000000037ABB96100000000000000000000
000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000
000000000000025788300000000005886410000000000000
000000000007DFFFFFFD9643347BFFFFFFFB400000000000
0000000004EFFFFFFFFFFFFFFFFFFFFFFFFFFB1000000000
000000007FFFFFFFFFFFFFFFFFFFFFFFFFFFFFD200000000
00000006FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFE10000000
0000003FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFB0000000
000000BFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF5000000
000003FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFD000000
000009FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF200000
00000DFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF600000
00000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF800000
00001FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA00000
00001FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFB00000
00001FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFB00000
00001FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFB00000
00001FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA00000
00000EFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF700000
000006FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFE100000
0000008FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFD3000000
000000014555555555555555555555555555555300000000
000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000
}
















skinparam rectangle<<container>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #438DD5
    BorderColor #3C7FC0
}

skinparam database<<container>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #438DD5
    BorderColor #3C7FC0
}

skinparam queue<<container>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #438DD5
    BorderColor #3C7FC0
}

skinparam rectangle<<external_container>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #B3B3B3
    BorderColor #A6A6A6
}

skinparam database<<external_container>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #B3B3B3
    BorderColor #A6A6A6
}

skinparam queue<<external_container>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #B3B3B3
    BorderColor #A6A6A6
}

















skinparam rectangle<<component>> {
    StereotypeFontColor #000000
    FontColor #000000
    BackgroundColor #85BBF0
    BorderColor #78A8D8
}

skinparam database<<component>> {
    StereotypeFontColor #000000
    FontColor #000000
    BackgroundColor #85BBF0
    BorderColor #78A8D8
}

skinparam queue<<component>> {
    StereotypeFontColor #000000
    FontColor #000000
    BackgroundColor #85BBF0
    BorderColor #78A8D8
}

skinparam rectangle<<external_component>> {
    StereotypeFontColor #000000
    FontColor #000000
    BackgroundColor #CCCCCC
    BorderColor #BFBFBF
}

skinparam database<<external_component>> {
    StereotypeFontColor #000000
    FontColor #000000
    BackgroundColor #CCCCCC
    BorderColor #BFBFBF
}

skinparam queue<<external_component>> {
    StereotypeFontColor #000000
    FontColor #000000
    BackgroundColor #CCCCCC
    BorderColor #BFBFBF
}











top to bottom direction


rectangle "<$person>\n==User\n\n User of the S-ENDA Vagrant setup." <<person>> as internal_user


rectangle "==Kubernetes environment\n<size:12>[System]</size>" <<boundary>> as k8s_env {

  rectangle "==postgis\n//<size:12>[configmap]</size>//\n\n passwd file for making PostGIS work in K8s." <<component>> as catalog_service_postgis_conf
  rectangle "==pycsw-config\n//<size:12>[configmap]</size>//\n\n Common PyCSW configuration file." <<component>> as pycsw_config
  rectangle "==dmci-config\n//<size:12>[configmap]</size>//\n\n Configuraiton file for DMCI." <<component>> as config_dmci

  rectangle "==postgis\n//<size:12>[service]</size>//\n\n Service component exposing PostGIS on port 5432." <<component>> as catalog_service_postgis_service
  rectangle "==pycsw\n//<size:12>[service]</size>//\n\n Service component exposing PyCSW API on port 80." <<component>> as pycsw_service
  rectangle "==dmci\n//<size:12>[service]</size>//\n\n Service component exposing DMCI API on port 8000." <<component>> as service_dmci
  rectangle "==mms-nats\n//<size:12>[service]</size>//\n\n MMS Nats service exposed on NodePort on 4222." <<component>> as service_mms_nats
  rectangle "==mms-http\n//<size:12>[service]</size>//\n\n MMS API service exposed on port 8080." <<component>> as service_mms_http


  rectangle "==postgis deployment\n<size:12>[Container]</size>" <<boundary>> as catalog_service_postgis_boundary {
    rectangle "==init-db-directory\n//<size:12>[alpine]</size>//\n\n Initialize database directory." <<component>> as init_db_directory
    rectangle "==postgis\n//<size:12>[postgis/postgis]</size>//\n\n Holds ISO data translated from MMD for PyCSW." <<component>> as catalog_service_postgis
catalog_service_postgis - ->> catalog_service_postgis_conf : **Mount passwd file**
  }

  database "==postgis\n//<size:12>[pvc]</size>//\n\n Permanent storage for PostGIS." <<component>> as catalog_service_postgis_storage
  database "==dmci-storage\n//<size:12>[pvc]</size>//\n\n Permanent archive storage for DMCI." <<component>> as storage_dmci
  database "==mms-workdir\n//<size:12>[pvc]</size>//\n\n Permanent storage for MMS." <<component>> as storage_mms

catalog_service_postgis - ->> catalog_service_postgis_storage : **Stores data in physical volume claim**

  rectangle "==pycsw deployment\n<size:12>[Container]</size>" <<boundary>> as pycsw_boundary {
    rectangle "==pycsw\n//<size:12>[geopython/pycsw]</size>//\n\n Running instance of PyCSW." <<component>> as pycsw1

pycsw1 - ->> pycsw_config : **Mount the config file**
pycsw_service - ->> pycsw1 : **LB**
  }

pycsw1 - ->> catalog_service_postgis_service : **Reads data from PostGIS.**
catalog_service_postgis_service - ->> catalog_service_postgis : **LB**

  rectangle "==dmci deployment\n<size:12>[Container]</size>" <<boundary>> as boundary_dmci {
    rectangle "==DMCI\n//<size:12>[container-dmci]</size>//\n\n The DMCI API." <<component>> as container_dmci

service_dmci - ->> container_dmci : **LB**
container_dmci - ->> storage_dmci : **Store XML files in archive, and persistent queue storage**
container_dmci -UP->> pycsw_service : **Insert new data**
container_dmci - ->> config_dmci : **Mount config file**
  }

  rectangle "==mms deployment\n<size:12>[Container]</size>" <<boundary>> as boundary_mms {
    rectangle "==mms\n//<size:12>[conainer-go-mms]</size>//\n\n MMS Messaging Service." <<component>> as container_go_mms

service_mms_nats - ->> container_go_mms : **LB**
service_mms_http - ->> container_go_mms : **LB**
container_go_mms - ->> storage_mms : **Stores database**
  }



internal_user - ->> pycsw_service : **Access CSW API via**\n//<size:12>[10.10.10.10:80]</size>//
internal_user - ->> service_dmci : **Access DMCI API via**\n//<size:12>[10.10.10.10:8000]</size>//
internal_user - ->> service_mms_nats : **Access MMS Nats via**\n//<size:12>[10.10.10.10:4222]</size>//
internal_user - ->> service_mms_http : **Access MMS API via**\n//<size:12>[10.10.10.10:8080]</size>//

}

@enduml

PlantUML version 1.2021.5(Sun Apr 25 13:20:28 CEST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: nb
Country: NO
--></g></svg>